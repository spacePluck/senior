# 방문 확인 및 서비스 이용 인증 시스템 기획서

> **"우리 손님이 맞는지 확인하고, 가족은 안심할 수 있도록"**

---

## 📋 개요

### 배경 및 문제점

**기존 플랫폼의 문제:**
1. **예약만 하고 실제 방문 안 함** → 매장 피해 (준비만 하고 낭비)
2. **누가 플랫폼 고객인지 모름** → 일반 고객과 구분 어려움
3. **가족이 확인할 방법 없음** → "정말 병원 갔을까?", "청소 진짜 했을까?"
4. **부정 사용 가능성** → 서비스 안 받고 "받았다"고 처리

### 우리의 해결책
1. **3단계 인증 시스템**
   - 예약 → 도착 확인 → 서비스 완료
2. **매장 인증코드 + GPS 기반 확인**
3. **실시간 가족 알림**
4. **타임스탬프 기록 (증거 확보)**

---

## 🎯 핵심 시나리오

### Case 1: 이발소 방문 (오프라인 매장)

#### 등장인물
- **김영수** (75세, 시니어)
- **명성이발관** (오프라인 매장, 인증코드: MS-2025-001)
- **김미영** (45세, 딸, 가족 앱 사용)

#### 타임라인
```
🕐 09:00 - 예약 완료
김영수 어르신이 앱에서 "명성이발관" 11시 예약

→ 매장 파트너센터 앱에 알림
→ 가족 앱(김미영)에 알림: "아버지 오늘 11시 이발 예약"

---

🕐 10:50 - 출발
앱이 자동으로 알림: "30분 후 예약이에요. 출발하세요!"

→ 가족 앱에 알림: "아버지 이발소 가실 시간이에요"

---

🕐 11:00 - 매장 도착
김영수 어르신이 매장 앞 도착
→ 앱에서 [도착했어요] 버튼 클릭 (GPS 자동 인식)

→ 앱 화면에 인증코드 표시:
   "사장님께 이 코드를 보여주세요"
   [MS-2025-001]
   (QR 코드 함께 표시)

→ 매장 파트너센터 앱에 알림: "김영수님 도착"
→ 가족 앱에 알림: "아버지 이발소 도착 (11:03)"

---

🕐 11:05 - 서비스 시작
매장 사장님이 인증코드 확인
→ 파트너센터 앱에서 "MS-2025-001" 입력 또는 QR 스캔
→ 고객 정보 확인: "김영수님 (이발 예약)"
→ "서비스 시작" 버튼 클릭

→ 타이머 시작 (서비스 시간 기록)
→ 가족 앱에 알림: "서비스 시작 (11:05)"

---

🕐 11:35 - 서비스 완료
이발 완료 (30분 소요)
→ 사장님이 "서비스 완료" 버튼 클릭
→ 결제 방식 선택 (현장/온라인)
→ 완료 처리

→ 시니어 앱에 완료 알림 + 포인트 적립
→ 가족 앱에 상세 알림:
   "✅ 아버지 이발 완료
    📍 명성이발관
    ⏰ 11:05 ~ 11:35 (30분)
    💰 15,000원 (현장 결제)"

→ 어르신께 만족도 조사 푸시 (1시간 후)
```

---

### Case 2: 청소 서비스 방문 (방문 서비스)

#### 등장인물
- **박순자** (68세, 시니어)
- **깨끗한 청소** (방문 청소 서비스)
- **청소 기사: 이영희** (50세)

#### 타임라인
```
🕐 14:00 - 예약 시간
박순자 어르신 댁에 청소 기사 방문 예정

---

🕐 13:55 - 청소 기사 출발 알림
박순자 앱에 알림: "청소 기사님이 5분 후 도착합니다"
(청소 기사 위치 실시간 추적 - 지도 표시)

→ 가족 앱에도 동시 알림

---

🕐 14:02 - 청소 기사 도착
청소 기사(이영희)가 박순자 댁 도착
→ 청소 기사 앱에서 [도착] 버튼 클릭 (GPS 인증)

→ 박순자 앱에 알림: "청소 기사님 도착"
→ 화면에 기사 정보 표시:
   "이름: 이영희
    소속: 깨끗한 청소
    경력: 5년
    평점: 4.8 / 5.0
    사진: [프로필 사진]

    [본인 확인 완료] 버튼"

→ 박순자 어르신이 [본인 확인 완료] 버튼 클릭
   (또는 자동으로 5분 후 확인 처리)

---

🕐 14:05 - 서비스 시작
청소 기사가 앱에서 "서비스 시작" 버튼 클릭
→ 청소 시작 사진 촬영 (before)
   - 거실, 주방, 화장실 등
→ 사진 자동 업로드 (플랫폼 서버)

→ 가족 앱에 알림: "청소 서비스 시작 (14:05)"
   + before 사진 함께 전송

---

🕐 16:30 - 서비스 완료
청소 완료 (2시간 30분)
→ 청소 기사가 "서비스 완료" 버튼 클릭
→ 청소 완료 사진 촬영 (after)
→ 사진 자동 업로드

→ 박순자 앱에 완료 알림
→ before/after 사진 비교 화면 표시
→ 서명 요청: "서비스가 만족스러우셨나요?"
   (손가락으로 서명 또는 [만족] 버튼)

→ 가족 앱에 상세 리포트:
   "✅ 청소 완료
    👩 이영희 기사
    ⏰ 14:05 ~ 16:30 (2시간 25분)
    📷 before/after 사진 첨부
    💰 80,000원"
```

---

## 🔐 인증 시스템 구조

### 3단계 인증 프로세스

```
[1단계] 예약 확정
    ↓
[2단계] 도착 확인 (GPS + 인증코드)
    ↓
[3단계] 서비스 완료 (사진 + 서명)
```

---

## 📍 1단계: 예약 확정

### 시니어 앱
**예약 완료 화면:**
```
━━━━━━━━━━━━━━━━━━━━
✅ 예약이 완료되었습니다!

📍 명성이발관
📅 1월 20일 (월) 오전 11시
💈 일반 이발
💰 15,000원

🔔 예약 시간 30분 전에
   알림을 보내드릴게요.

[예약 취소] [일정 추가]
━━━━━━━━━━━━━━━━━━━━
```

### 매장 파트너센터 앱
**푸시 알림:**
```
🔔 새 예약이 들어왔습니다!

김영수님
1월 20일 (월) 11:00
일반 이발

[수락하기] [거절하기]
```

**수락 후:**
```
✅ 예약 수락 완료

고객에게 확인 알림이 전송되었습니다.
```

### 가족 앱
**알림:**
```
🔔 아버지 예약 알림

명성이발관 (이발)
1월 20일 (월) 11:00

📍 위치 보기
📞 매장 전화하기
```

---

## 📍 2단계: 도착 확인

### 방법 1: GPS 자동 인식 (권장)

**시니어 앱 (자동):**
```
매장 반경 50m 진입 시 자동 감지

━━━━━━━━━━━━━━━━━━━━
📍 명성이발관 근처에 계시네요!

도착하셨나요?

[예, 도착했어요]
[아니요, 아직이에요]
━━━━━━━━━━━━━━━━━━━━
```

**[예, 도착했어요] 클릭 시:**
```
━━━━━━━━━━━━━━━━━━━━
✅ 도착 확인 완료!

사장님께 이 코드를 보여주세요:

╔═══════════════╗
║  MS-2025-001  ║
╚═══════════════╝

[QR 코드 표시]

또는 사장님께
"플랫폼으로 예약했어요"
라고 말씀하세요.
━━━━━━━━━━━━━━━━━━━━
```

### 방법 2: 수동 확인 (GPS 오류 시)

**시니어 앱:**
```
예약 상세 화면 하단

[도착 확인] 버튼 (수동 클릭)
```

### 매장 인증코드 확인

**파트너센터 앱 (매장용):**
```
━━━━━━━━━━━━━━━━━━━━
[오늘 예약]

11:00 김영수님 도착! 🟢

[고객 확인하기]
━━━━━━━━━━━━━━━━━━━━
```

**[고객 확인하기] 클릭:**
```
━━━━━━━━━━━━━━━━━━━━
고객 확인

고객이 보여주는 코드를 확인하세요:
MS-2025-001

또는 QR 코드를 스캔하세요.

[QR 스캔] [코드 입력]
━━━━━━━━━━━━━━━━━━━━
```

**코드 확인 후:**
```
✅ 김영수님 본인 확인 완료!

서비스: 일반 이발 (15,000원)

[서비스 시작하기]
━━━━━━━━━━━━━━━━━━━━
```

### 가족 앱 알림
```
🔔 아버지 도착 알림

📍 명성이발관 도착
⏰ 11:03 (예약 11:00)

잠시 후 서비스가 시작됩니다.
```

---

## 📍 3단계: 서비스 완료

### A. 오프라인 매장 (이발소, 음식점 등)

**파트너센터 앱:**
```
서비스 중...
⏱ 경과 시간: 28분

[서비스 완료]
━━━━━━━━━━━━━━━━━━━━
```

**[서비스 완료] 클릭:**
```
━━━━━━━━━━━━━━━━━━━━
서비스 완료 처리

김영수님
일반 이발
소요 시간: 30분

결제 방식을 선택하세요:
[ ] 현장 결제 (현금/카드)
[ ] 온라인 결제

[완료하기]
━━━━━━━━━━━━━━━━━━━━
```

**완료 후:**
```
✅ 서비스 완료!

매출: 15,000원
수수료: 1,500원 (10%)
정산 금액: 13,500원

고객에게 완료 알림이 전송되었습니다.
```

### B. 방문 서비스 (청소, 수리 등)

**청소 기사 앱:**
```
━━━━━━━━━━━━━━━━━━━━
서비스 시작

Before 사진을 촬영하세요:
- 거실
- 주방
- 화장실
- 방

[사진 촬영] (4장)
━━━━━━━━━━━━━━━━━━━━
```

**사진 촬영 가이드:**
- 자동으로 사진 4장 촬영 모드
- 각 공간별 라벨 자동 부여
- GPS 및 타임스탬프 자동 기록

**청소 완료 후:**
```
━━━━━━━━━━━━━━━━━━━━
서비스 완료

After 사진을 촬영하세요:
- 거실 ✅
- 주방 ✅
- 화장실 ✅
- 방 ✅

[서비스 완료]
━━━━━━━━━━━━━━━━━━━━
```

**고객 확인 요청:**
```
박순자 앱에 표시:

━━━━━━━━━━━━━━━━━━━━
청소 완료!

Before / After 사진을 확인하세요.

[사진 보기]

서비스가 만족스러우셨나요?

👍 만족해요
👎 불만족

또는 서명으로 확인:
[서명란]
━━━━━━━━━━━━━━━━━━━━
```

---

## 🚨 부정 사용 방지 시스템

### 문제 상황 및 대응

#### 1. 예약하고 방문 안 함 (No-show)
**감지:**
```
예약 시간 + 30분 경과
  → 도착 확인 안 됨
  → 자동으로 "미방문" 처리
```

**패널티:**
```
1회: 경고 알림
2회: 다음 예약 시 선결제 필수
3회 이상: 계정 정지 7일
```

**매장 보상:**
```
미방문으로 인한 매장 손실:
  → 플랫폼이 손실 보상 (예약 금액의 50%)
```

#### 2. 가짜 인증코드 사용 시도
**감지:**
```
파트너센터 앱에서 잘못된 코드 입력
  → 자동으로 플랫폼에 알림
  → 고객 계정 잠금
```

**확인:**
```
플랫폼 콜센터가 양측에 전화
  → 상황 확인
  → 오해인 경우 잠금 해제
  → 고의인 경우 영구 정지
```

#### 3. 서비스 안 받고 "완료" 처리
**감지:**
```
서비스 시간이 비정상적으로 짧음
  예: 청소 예상 시간 2시간 → 실제 10분
  → 자동 경고 알림 (관리자)
```

**확인:**
```
고객에게 자동 전화:
  "서비스가 정상적으로 완료되었나요?"

불만족 시:
  → 환불 처리
  → 업체 조사
  → 재서비스 제공
```

#### 4. GPS 조작 시도
**감지:**
```
GPS 좌표가 비정상적으로 빠르게 이동
또는 매장 위치와 거리 차이 큼
  → 의심 거래로 표시
```

**추가 인증:**
```
매장 인증코드 입력 필수 (QR 스캔만으로 안 됨)
+ 매장에서 확인 사진 촬영 요청
```

---

## 📷 사진 인증 시스템 (방문 서비스용)

### Before/After 사진 가이드

**필수 사진:**
- 방문 서비스(청소, 수리 등): Before/After 필수
- 오프라인 매장: 불필요

**자동 메타데이터 기록:**
```
사진 촬영 시 자동 저장:
- GPS 좌표 (위/경도)
- 촬영 시각 (타임스탬프)
- 촬영 기기 (청소 기사 휴대폰 정보)
- 업로드 시각
```

**사진 품질 체크:**
```
AI가 자동 검증:
- 흐릿한 사진 → 재촬영 요청
- 너무 어두운 사진 → 재촬영 요청
- 같은 장소인지 확인 (AI 이미지 분석)
```

---

## 🔔 실시간 알림 시스템

### 시니어 앱 알림

| 시점 | 알림 내용 |
|------|----------|
| 예약 완료 | "예약이 완료되었습니다. 1월 20일 11시에 명성이발관에 가세요." |
| 30분 전 | "30분 후 예약이에요. 출발 준비하세요!" |
| 도착 감지 | "매장 근처에 계시네요! 도착하셨나요?" |
| 서비스 시작 | "서비스가 시작되었습니다." |
| 서비스 완료 | "이발이 완료되었습니다. 포인트 500P 적립!" |

### 가족 앱 알림

| 시점 | 알림 내용 |
|------|----------|
| 예약 완료 | "아버지가 오늘 11시에 이발 예약하셨어요." |
| 30분 전 | "아버지 곧 이발소 가실 시간이에요." |
| 도착 | "아버지가 명성이발관에 도착하셨어요 (11:03)" |
| 서비스 시작 | "서비스 시작 (11:05)" |
| 서비스 완료 | "✅ 아버지 이발 완료 (11:35)<br>소요 시간: 30분<br>결제: 15,000원" |
| 미방문 시 | "⚠️ 아버지가 예약 시간에 매장에 방문하지 않으셨어요. 확인이 필요합니다." |

### 매장 파트너센터 앱 알림

| 시점 | 알림 내용 |
|------|----------|
| 새 예약 | "새 예약: 김영수님 (1월 20일 11시)" |
| 고객 도착 | "김영수님이 도착하셨습니다." |
| 고객 미방문 | "예약 시간 30분 경과. 김영수님 미방문." |

---

## 🕒 타임라인 기록 시스템

### 모든 단계의 타임스탬프 저장

**데이터베이스 기록:**
```json
{
  "예약_ID": "RES-2025-12345",
  "고객": "김영수",
  "매장": "명성이발관",
  "타임라인": [
    {
      "단계": "예약_완료",
      "시각": "2025-01-19 15:30:22",
      "GPS": null
    },
    {
      "단계": "출발_알림",
      "시각": "2025-01-20 10:30:00",
      "GPS": "37.5347, 127.1239"
    },
    {
      "단계": "도착_확인",
      "시각": "2025-01-20 11:03:15",
      "GPS": "37.5401, 127.1285"
    },
    {
      "단계": "서비스_시작",
      "시각": "2025-01-20 11:05:40",
      "확인자": "매장_사장"
    },
    {
      "단계": "서비스_완료",
      "시각": "2025-01-20 11:35:20",
      "확인자": "매장_사장",
      "소요시간": "29분 40초"
    },
    {
      "단계": "결제_완료",
      "시각": "2025-01-20 11:36:10",
      "방식": "현장결제",
      "금액": 15000
    }
  ]
}
```

**활용:**
- 분쟁 발생 시 증거 자료
- 서비스 품질 분석 (평균 소요 시간 등)
- 가족에게 상세 리포트 제공

---

## 📊 대시보드 (관리자용)

### 실시간 모니터링

**전체 현황:**
```
[오늘 현황]
━━━━━━━━━━━━━━━━━━━━
총 예약: 324건
진행 중: 42건
완료: 278건
미방문: 4건 (1.2%)
━━━━━━━━━━━━━━━━━━━━

[실시간 알림]
⚠️ 미방문 발생: 김XX님 (강동구)
✅ 서비스 완료: 박XX님 (송파구)
```

**이상 거래 감지:**
```
[의심 거래]
━━━━━━━━━━━━━━━━━━━━
• 예약 RES-12345
  고객: 이XX
  매장: ABC 청소
  문제: GPS 좌표 이상 (거리 10km 차이)

  [조사하기]
━━━━━━━━━━━━━━━━━━━━
```

---

## 💡 차별화 포인트

### 기존 플랫폼과 비교

| 기능 | 배민/쿠팡이츠 | 당근마켓 | 네이버 예약 | 우리 플랫폼 |
|------|--------------|----------|------------|------------|
| 도착 확인 | ❌ | ❌ | ❌ | ✅ GPS + 코드 |
| 서비스 시작 기록 | ❌ | ❌ | ❌ | ✅ |
| Before/After 사진 | ⚠️ 음식만 | ❌ | ❌ | ✅ 방문 서비스 |
| 가족 실시간 알림 | ❌ | ❌ | ❌ | ✅ |
| 미방문 패널티 | ⚠️ 약함 | ❌ | ❌ | ✅ 강력 |
| 타임라인 기록 | ❌ | ❌ | ❌ | ✅ 전체 과정 |

---

## 🚀 기술 구현 방안

### GPS 정확도 향상
```javascript
// 위치 정확도 체크
const checkLocation = async () => {
  const position = await getCurrentPosition({
    enableHighAccuracy: true,  // 고정밀 모드
    timeout: 5000,
    maximumAge: 0
  });

  // 정확도 50m 이내일 때만 인정
  if (position.accuracy < 50) {
    return true;
  } else {
    return "GPS 신호가 약합니다. 잠시 후 다시 시도해주세요.";
  }
};
```

### QR 코드 생성
```javascript
// 매장 인증코드 QR 생성
const generateQR = (storeCode) => {
  const qrData = {
    code: storeCode,
    type: "STORE_AUTH",
    timestamp: Date.now(),
    signature: generateSignature(storeCode)  // 위조 방지
  };

  return QRCode.toDataURL(JSON.stringify(qrData));
};
```

### 사진 메타데이터 추출
```javascript
// 사진 촬영 시 GPS 및 시각 자동 기록
const capturePhoto = async () => {
  const photo = await Camera.getPhoto();
  const location = await Geolocation.getCurrentPosition();

  return {
    image: photo.dataUrl,
    metadata: {
      latitude: location.coords.latitude,
      longitude: location.coords.longitude,
      timestamp: new Date().toISOString(),
      device: getDeviceInfo()
    }
  };
};
```

---

## 📋 체크리스트

### 서비스 시작 전 확인 사항
- [ ] GPS 권한 허용 (시니어 앱, 파트너 앱)
- [ ] 카메라 권한 허용 (방문 서비스용)
- [ ] 푸시 알림 권한 허용 (모든 앱)
- [ ] 매장 인증코드 발급 완료
- [ ] 매장에 인증코드 포스터 부착
- [ ] 파트너센터 앱 사용법 교육 완료

### 테스트 시나리오
- [ ] 정상 방문 → 도착 → 서비스 → 완료 (전체 플로우)
- [ ] GPS 꺼진 상태에서 수동 확인
- [ ] 잘못된 인증코드 입력 시 오류 처리
- [ ] 미방문 시 자동 처리 및 알림
- [ ] Before/After 사진 업로드 (방문 서비스)
- [ ] 가족 앱 실시간 알림 동작 확인

---

## 🎯 성공 지표

### KPI 목표
- **도착 확인율**: 95% 이상
- **미방문율**: 5% 이하
- **서비스 완료 확인율**: 99% 이상
- **부정 사용 적발**: 0.1% 이하
- **가족 앱 알림 도달률**: 98% 이상

### 모니터링 지표
- 평균 도착 지연 시간 (예약 시간 대비)
- 평균 서비스 소요 시간 (업종별)
- GPS 오류율 (위치 확인 실패)
- 사진 재촬영 요청률 (방문 서비스)
