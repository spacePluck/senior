# Phase 1 - íƒì‹œ ë° ì´ë™ ì„œë¹„ìŠ¤
## ê¸°ëŠ¥ ìƒì„¸ ê¸°íšì„œ

> **ê°œë°œ ìš°ì„ ìˆœìœ„**: â­â­ (ì¤‘ìš”)
> **ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 2ì£¼
> **ë‹´ë‹¹**: Frontend 1ëª…
> **ê¸°ìˆ **: Kakao Mobility API, Kakao Map API

---

## ê¸°ëŠ¥ ê°œìš”

### í•µì‹¬ ê°€ì¹˜
- ì‹œë‹ˆì–´ë„ ì‰½ê²Œ íƒì‹œë¥¼ ë¶€ë¥¼ ìˆ˜ ìˆëŠ” **ì´ˆê°„ë‹¨ ì¸í„°í˜ì´ìŠ¤**
- ê°€ì¡±ì´ ë¶€ëª¨ë‹˜ì„ ìœ„í•´ **ëŒ€ë¦¬ í˜¸ì¶œ** ê°€ëŠ¥
- ì‹¤ì‹œê°„ ìœ„ì¹˜ ê³µìœ ë¡œ **ì•ˆì‹¬**

### Phase 1 ë²”ìœ„
- âœ… ì¹´ì¹´ì˜¤íƒì‹œ ê°„í¸ í˜¸ì¶œ (ë”¥ë§í¬)
- âœ… ë‹¨ê³¨ ëª©ì ì§€ ì €ì¥ (ë³‘ì›, ë§ˆíŠ¸ ë“±)
- âœ… ê°€ì¡± ëŒ€ë¦¬ í˜¸ì¶œ
- âœ… íƒ‘ìŠ¹ ì•ˆë‚´ í‘¸ì‹œ ì•Œë¦¼
- âœ… ê°€ì¡±ì—ê²Œ ì‹¤ì‹œê°„ ìœ„ì¹˜ ê³µìœ 
- â¸ï¸ ì•± ë‚´ ì§ì ‘ í˜¸ì¶œ (Phase 2)
- â¸ï¸ ìë™ ê²°ì œ ì—°ë™ (Phase 2)

---

## ë©”ì¸ í™”ë©´

### í™”ë©´: `/transport/taxi`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  íƒì‹œ ë¶€ë¥´ê¸°                         â”‚
â”‚                                      â”‚
â”‚  ì–´ë””ë¡œ ê°€ì‹œë‚˜ìš”?                    â”‚
â”‚                                      â”‚
â”‚  â”â”â” ìì£¼ ê°€ëŠ” ê³³ â”â”â”              â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ ğŸ¥ ì„œìš¸ëŒ€ë³‘ì›      â”‚             â”‚
â”‚  â”‚ ì„œìš¸ì‹œ ì¢…ë¡œêµ¬...   â”‚             â”‚
â”‚  â”‚ [íƒì‹œ í˜¸ì¶œ]        â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ ğŸ¬ ì´ë§ˆíŠ¸ ì²œí˜¸ì    â”‚             â”‚
â”‚  â”‚ ì„œìš¸ì‹œ ê°•ë™êµ¬...   â”‚             â”‚
â”‚  â”‚ [íƒì‹œ í˜¸ì¶œ]        â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ ğŸ¡ í°ë”¸ ì§‘         â”‚             â”‚
â”‚  â”‚ ì„œìš¸ì‹œ ì†¡íŒŒêµ¬...   â”‚             â”‚
â”‚  â”‚ [íƒì‹œ í˜¸ì¶œ]        â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                      â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”‚
â”‚                                      â”‚
â”‚  [+ ìƒˆ ëª©ì ì§€ ì¶”ê°€]                 â”‚
â”‚                                      â”‚
â”‚  [ì£¼ì†Œ ì§ì ‘ ì…ë ¥í•˜ê³  íƒì‹œ ë¶€ë¥´ê¸°]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## íƒì‹œ í˜¸ì¶œ í™•ì¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  íƒì‹œ í˜¸ì¶œ í™•ì¸                      â”‚
â”‚                                      â”‚
â”‚  ğŸš• ì¹´ì¹´ì˜¤íƒì‹œë¡œ í˜¸ì¶œí•©ë‹ˆë‹¤         â”‚
â”‚                                      â”‚
â”‚  ì¶œë°œì§€:                             â”‚
â”‚  ğŸ“ í˜„ì¬ ìœ„ì¹˜                       â”‚
â”‚  ì„œìš¸ì‹œ ê°•ë™êµ¬ ì²œí˜¸ë™ 123-45        â”‚
â”‚                                      â”‚
â”‚  ë„ì°©ì§€:                             â”‚
â”‚  ğŸ¥ ì„œìš¸ëŒ€ë³‘ì›                      â”‚
â”‚  ì„œìš¸ì‹œ ì¢…ë¡œêµ¬ ëŒ€í•™ë¡œ 101           â”‚
â”‚                                      â”‚
â”‚  ì˜ˆìƒ ìš”ê¸ˆ: 15,000ì›                â”‚
â”‚  ì˜ˆìƒ ì‹œê°„: 25ë¶„                    â”‚
â”‚                                      â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”‚
â”‚                                      â”‚
â”‚  â˜‘ ê°€ì¡±ì—ê²Œ ì•Œë¦¼ ë³´ë‚´ê¸°             â”‚
â”‚  (ì‹¤ì‹œê°„ ìœ„ì¹˜ ê³µìœ )                  â”‚
â”‚                                      â”‚
â”‚  í°ë”¸ (ê¹€ë¯¸ì˜) â˜‘                    â”‚
â”‚  ì‘ì€ë”¸ (ê¹€ìˆ˜ì˜) â˜                  â”‚
â”‚                                      â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”‚
â”‚                                      â”‚
â”‚  [íƒì‹œ í˜¸ì¶œí•˜ê¸°]                    â”‚
â”‚  [ì·¨ì†Œ]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì¹´ì¹´ì˜¤íƒì‹œ ì—°ë™

### ë”¥ë§í¬ ë°©ì‹ (Phase 1)
```typescript
// ì¹´ì¹´ì˜¤íƒì‹œ ì•± ì‹¤í–‰
const callKakaoTaxi = async ({
  startX,
  startY,
  startAddress,
  endX,
  endY,
  endAddress
}: TaxiCallParams) => {
  // ì¹´ì¹´ì˜¤íƒì‹œ ë”¥ë§í¬ ìƒì„±
  const deepLink = `kakaotaxi://launch?` +
    `start_x=${startX}&start_y=${startY}&start_name=${encodeURIComponent(startAddress)}&` +
    `end_x=${endX}&end_y=${endY}&end_name=${encodeURIComponent(endAddress)}`;

  // ì•± ì„¤ì¹˜ í™•ì¸
  const isKakaoTaxiInstalled = await checkAppInstalled('kakaotaxi');

  if (isKakaoTaxiInstalled) {
    // ì¹´ì¹´ì˜¤íƒì‹œ ì•± ì‹¤í–‰
    Linking.openURL(deepLink);
  } else {
    // ì•± ì„¤ì¹˜ ì•ˆë‚´
    Alert.alert(
      'ì¹´ì¹´ì˜¤íƒì‹œ ì„¤ì¹˜ í•„ìš”',
      'ì¹´ì¹´ì˜¤íƒì‹œ ì•±ì„ ì„¤ì¹˜í•´ì£¼ì„¸ìš”',
      [
        { text: 'ì·¨ì†Œ' },
        {
          text: 'ì„¤ì¹˜í•˜ê¸°',
          onPress: () => {
            const storeUrl = Platform.select({
              ios: 'https://apps.apple.com/app/id981110422',
              android: 'market://details?id=com.kakao.taxi'
            });
            Linking.openURL(storeUrl);
          }
        }
      ]
    );
  }
};
```

### ê°€ì¡± ì•Œë¦¼ ë°œì†¡
```typescript
const sendTaxiNotificationToFamily = async ({
  userId,
  destination,
  selectedFamilyIds
}: {
  userId: string;
  destination: string;
  selectedFamilyIds: string[];
}) => {
  // íƒì‹œ í˜¸ì¶œ ê¸°ë¡ ì €ì¥
  const { data: taxiCall } = await supabase
    .from('taxi_calls')
    .insert({
      user_id: userId,
      destination,
      start_time: new Date(),
      status: 'called'
    })
    .select()
    .single();

  // ì„ íƒëœ ê°€ì¡±ë“¤ì—ê²Œ í‘¸ì‹œ ì•Œë¦¼
  for (const familyId of selectedFamilyIds) {
    await sendNotification({
      userId: familyId,
      title: 'ğŸš• íƒì‹œ í˜¸ì¶œ ì•Œë¦¼',
      body: `ì–´ë¨¸ë‹ˆê°€ ${destination}(ìœ¼)ë¡œ ê°€ëŠ” íƒì‹œë¥¼ í˜¸ì¶œí•˜ì…¨ìŠµë‹ˆë‹¤`,
      data: {
        type: 'taxi_call',
        taxiCallId: taxiCall.id,
        startLocation: taxiCall.start_location
      }
    });
  }

  // ì‹¤ì‹œê°„ ìœ„ì¹˜ ê³µìœ  ì‹œì‘
  await startLocationSharing(userId, selectedFamilyIds);
};
```

---

## ë‹¨ê³¨ ëª©ì ì§€ ê´€ë¦¬

### ëª©ì ì§€ ì¶”ê°€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ë‹¨ê³¨ ëª©ì ì§€ ì¶”ê°€                    â”‚
â”‚                                      â”‚
â”‚  ì´ë¦„ *                              â”‚
â”‚  [ì„œìš¸ëŒ€ë³‘ì›]                       â”‚
â”‚                                      â”‚
â”‚  ì£¼ì†Œ ê²€ìƒ‰ *                         â”‚
â”‚  [ì„œìš¸ì‹œ ì¢…ë¡œêµ¬ ëŒ€í•™ë¡œ 101]         â”‚
â”‚  [ê²€ìƒ‰í•˜ê¸°]                         â”‚
â”‚                                      â”‚
â”‚  ì¹´í…Œê³ ë¦¬                            â”‚
â”‚  â—‰ ë³‘ì›                             â”‚
â”‚  â—‹ ë§ˆíŠ¸/ì‡¼í•‘                        â”‚
â”‚  â—‹ ê°€ì¡± ì§‘                          â”‚
â”‚  â—‹ ê¸°íƒ€                             â”‚
â”‚                                      â”‚
â”‚  ì•„ì´ì½˜ ì„ íƒ                         â”‚
â”‚  ğŸ¥ ğŸ¬ ğŸ¡ ğŸ½ï¸ ğŸ’’ ğŸ¢               â”‚
â”‚                                      â”‚
â”‚  ë©”ëª¨ (ì„ íƒ)                         â”‚
â”‚  [ì •í˜•ì™¸ê³¼ 3ì¸µ, ë°•OO ì„ ìƒë‹˜]        â”‚
â”‚                                      â”‚
â”‚  [ì €ì¥í•˜ê¸°]                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì‹¤ì‹œê°„ ìœ„ì¹˜ ê³µìœ 

### ê°€ì¡± ì•± í™”ë©´
```
[ê°€ì¡± ì•± í™”ë©´]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸš• íƒì‹œ íƒ‘ìŠ¹ ì¤‘                    â”‚
â”‚                                      â”‚
â”‚  ì–´ë¨¸ë‹ˆê°€ íƒì‹œë¥¼ íƒ€ê³                â”‚
â”‚  ì„œìš¸ëŒ€ë³‘ì›ìœ¼ë¡œ ì´ë™ ì¤‘ì…ë‹ˆë‹¤       â”‚
â”‚                                      â”‚
â”‚  [ì§€ë„ í‘œì‹œ]                        â”‚
â”‚  ğŸ“ í˜„ì¬ ìœ„ì¹˜ ì‹¤ì‹œê°„ ì¶”ì            â”‚
â”‚                                      â”‚
â”‚  ì¶œë°œ: 09:15                         â”‚
â”‚  í˜„ì¬: 09:32 (17ë¶„ ê²½ê³¼)            â”‚
â”‚  ë„ì°© ì˜ˆì •: 09:40 (8ë¶„ ë‚¨ìŒ)        â”‚
â”‚                                      â”‚
â”‚  ë‚¨ì€ ê±°ë¦¬: ì•½ 3.2km                â”‚
â”‚                                      â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”‚
â”‚                                      â”‚
â”‚  ë„ì°©ì§€: ì„œìš¸ëŒ€ë³‘ì›                 â”‚
â”‚  ì„œìš¸ì‹œ ì¢…ë¡œêµ¬ ëŒ€í•™ë¡œ 101           â”‚
â”‚                                      â”‚
â”‚  [ì „í™”í•˜ê¸°] [ë©”ì‹œì§€ ë³´ë‚´ê¸°]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ê°€ì¡± ëŒ€ë¦¬ í˜¸ì¶œ

### ê°€ì¡± ì•± í™”ë©´
```
[ê°€ì¡± ì•± í™”ë©´]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ë¶€ëª¨ë‹˜ íƒì‹œ í˜¸ì¶œ                    â”‚
â”‚                                      â”‚
â”‚  ì–´ë¨¸ë‹ˆë¥¼ ìœ„í•œ íƒì‹œë¥¼ ë¶€ë¦…ë‹ˆë‹¤      â”‚
â”‚                                      â”‚
â”‚  ì¶œë°œì§€:                             â”‚
â”‚  ğŸ¡ ì–´ë¨¸ë‹ˆ ëŒ                       â”‚
â”‚  ì„œìš¸ì‹œ ê°•ë™êµ¬ ì²œí˜¸ë™ 123-45        â”‚
â”‚  [ìœ„ì¹˜ ë³€ê²½]                        â”‚
â”‚                                      â”‚
â”‚  ë„ì°©ì§€:                             â”‚
â”‚  [ì„œìš¸ëŒ€ë³‘ì› â–¼]                     â”‚
â”‚                                      â”‚
â”‚  â€¢ ì„œìš¸ëŒ€ë³‘ì›                       â”‚
â”‚  â€¢ ì´ë§ˆíŠ¸ ì²œí˜¸ì                     â”‚
â”‚  â€¢ í°ë”¸ ì§‘                          â”‚
â”‚  [+ ìƒˆ ëª©ì ì§€ ì…ë ¥]                 â”‚
â”‚                                      â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”‚
â”‚                                      â”‚
â”‚  ì˜ˆìƒ ìš”ê¸ˆ: 15,000ì›                â”‚
â”‚  ì˜ˆìƒ ì‹œê°„: 25ë¶„                    â”‚
â”‚                                      â”‚
â”‚  â˜‘ ì–´ë¨¸ë‹ˆê»˜ ì•Œë¦¼ ë³´ë‚´ê¸°             â”‚
â”‚  "ë”¸ì´ ë³‘ì› ê°€ì‹œëŠ” íƒì‹œë¥¼           â”‚
â”‚   ë¶ˆëŸ¬ë“œë ¸ì–´ìš”"                      â”‚
â”‚                                      â”‚
â”‚  [íƒì‹œ í˜¸ì¶œí•˜ê¸°]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì‹œë‹ˆì–´ ì•Œë¦¼
```
[ì‹œë‹ˆì–´ ì•± í™”ë©´]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“± ë”¸ì´ íƒì‹œë¥¼ ë¶ˆëŸ¬ë“œë ¸ì–´ìš”        â”‚
â”‚                                      â”‚
â”‚  í°ë”¸ (ê¹€ë¯¸ì˜)ì´ ì„œìš¸ëŒ€ë³‘ì›ìœ¼ë¡œ     â”‚
â”‚  ê°€ëŠ” íƒì‹œë¥¼ í˜¸ì¶œí–ˆìŠµë‹ˆë‹¤           â”‚
â”‚                                      â”‚
â”‚  íƒì‹œê°€ 5ë¶„ í›„ ë„ì°©í•©ë‹ˆë‹¤           â”‚
â”‚  (ì˜¤ì „ 9ì‹œ 20ë¶„)                    â”‚
â”‚                                      â”‚
â”‚  ì¶œë°œì§€: ìš°ë¦¬ì§‘                      â”‚
â”‚  ë„ì°©ì§€: ì„œìš¸ëŒ€ë³‘ì›                 â”‚
â”‚                                      â”‚
â”‚  [ì¤€ë¹„í•˜ê¸°] [ë”¸ì—ê²Œ ì „í™”í•˜ê¸°]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## DB ìŠ¤í‚¤ë§ˆ

```sql
CREATE TABLE favorite_destinations (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id),
  name VARCHAR(100) NOT NULL,
  address TEXT NOT NULL,
  latitude DECIMAL(10, 8) NOT NULL,
  longitude DECIMAL(11, 8) NOT NULL,
  category VARCHAR(50), -- 'hospital', 'market', 'family', 'other'
  icon VARCHAR(10),
  notes TEXT,
  usage_count INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE TABLE taxi_calls (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id),

  -- í˜¸ì¶œ ì •ë³´
  caller_id UUID REFERENCES users(id), -- ëŒ€ë¦¬ í˜¸ì¶œí•œ ê°€ì¡± (ë³¸ì¸ì´ë©´ NULL)

  -- ì¶œë°œì§€
  start_address TEXT NOT NULL,
  start_latitude DECIMAL(10, 8) NOT NULL,
  start_longitude DECIMAL(11, 8) NOT NULL,

  -- ë„ì°©ì§€
  destination_id UUID REFERENCES favorite_destinations(id),
  destination_address TEXT NOT NULL,
  destination_latitude DECIMAL(10, 8) NOT NULL,
  destination_longitude DECIMAL(11, 8) NOT NULL,

  -- ì‹œê°„ ì •ë³´
  called_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  estimated_arrival_time TIMESTAMP WITH TIME ZONE,
  actual_arrival_time TIMESTAMP WITH TIME ZONE,

  -- ìƒíƒœ
  status VARCHAR(20) DEFAULT 'called', -- 'called', 'picked_up', 'arrived', 'cancelled'

  -- ìœ„ì¹˜ ê³µìœ 
  shared_with_family UUID[], -- ìœ„ì¹˜ë¥¼ ê³µìœ ë°›ëŠ” ê°€ì¡±ë“¤ì˜ ID

  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE TABLE taxi_location_tracking (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  taxi_call_id UUID NOT NULL REFERENCES taxi_calls(id),
  latitude DECIMAL(10, 8) NOT NULL,
  longitude DECIMAL(11, 8) NOT NULL,
  recorded_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

---

## API ì—”ë“œí¬ì¸íŠ¸

### íƒì‹œ í˜¸ì¶œ
```typescript
// POST /api/taxi/call
export async function POST(req: Request) {
  const {
    userId,
    callerId, // ëŒ€ë¦¬ í˜¸ì¶œì¸ ê²½ìš°
    startLocation,
    destinationId,
    destinationLocation,
    sharedWithFamily
  } = await req.json();

  // íƒì‹œ í˜¸ì¶œ ê¸°ë¡ ì €ì¥
  const { data: taxiCall } = await supabase
    .from('taxi_calls')
    .insert({
      user_id: userId,
      caller_id: callerId,
      start_address: startLocation.address,
      start_latitude: startLocation.latitude,
      start_longitude: startLocation.longitude,
      destination_id: destinationId,
      destination_address: destinationLocation.address,
      destination_latitude: destinationLocation.latitude,
      destination_longitude: destinationLocation.longitude,
      shared_with_family: sharedWithFamily,
      status: 'called'
    })
    .select()
    .single();

  // ë‹¨ê³¨ ëª©ì ì§€ ì‚¬ìš© íšŸìˆ˜ ì¦ê°€
  if (destinationId) {
    await supabase
      .from('favorite_destinations')
      .update({ usage_count: supabase.raw('usage_count + 1') })
      .eq('id', destinationId);
  }

  // ê°€ì¡±ì—ê²Œ ì•Œë¦¼
  if (sharedWithFamily && sharedWithFamily.length > 0) {
    await Promise.all(
      sharedWithFamily.map(familyId =>
        sendNotification({
          userId: familyId,
          title: 'ğŸš• íƒì‹œ í˜¸ì¶œ',
          body: callerId
            ? `${await getUserName(callerId)}ë‹˜ì´ ì–´ë¨¸ë‹ˆ íƒì‹œë¥¼ í˜¸ì¶œí–ˆìŠµë‹ˆë‹¤`
            : `ì–´ë¨¸ë‹ˆê°€ ${destinationLocation.address}(ìœ¼)ë¡œ ê°€ëŠ” íƒì‹œë¥¼ í˜¸ì¶œí–ˆìŠµë‹ˆë‹¤`,
          data: {
            type: 'taxi_call',
            taxiCallId: taxiCall.id
          }
        })
      )
    );
  }

  // ëŒ€ë¦¬ í˜¸ì¶œì¸ ê²½ìš° ì‹œë‹ˆì–´ì—ê²Œ ì•Œë¦¼
  if (callerId) {
    await sendNotification({
      userId,
      title: 'ğŸ“± íƒì‹œê°€ í˜¸ì¶œë˜ì—ˆìŠµë‹ˆë‹¤',
      body: `${await getUserName(callerId)}ë‹˜ì´ ${destinationLocation.address}(ìœ¼)ë¡œ ê°€ëŠ” íƒì‹œë¥¼ ë¶ˆëŸ¬ë“œë ¸ìŠµë‹ˆë‹¤`,
      data: {
        type: 'taxi_proxy_call',
        taxiCallId: taxiCall.id
      }
    });
  }

  return Response.json({ success: true, data: taxiCall });
}
```

### ë‹¨ê³¨ ëª©ì ì§€ ê´€ë¦¬
```typescript
// GET /api/destinations
export async function GET(req: Request) {
  const { searchParams } = new URL(req.url);
  const userId = searchParams.get('userId');

  const { data } = await supabase
    .from('favorite_destinations')
    .select('*')
    .eq('user_id', userId)
    .order('usage_count', { ascending: false });

  return Response.json({ success: true, data });
}

// POST /api/destinations
export async function POST(req: Request) {
  const {
    userId,
    name,
    address,
    latitude,
    longitude,
    category,
    icon,
    notes
  } = await req.json();

  const { data } = await supabase
    .from('favorite_destinations')
    .insert({
      user_id: userId,
      name,
      address,
      latitude,
      longitude,
      category,
      icon,
      notes
    })
    .select()
    .single();

  return Response.json({ success: true, data });
}
```

---

## ìœ„ì¹˜ ê³µìœ  ê¸°ëŠ¥

```typescript
// ì‹¤ì‹œê°„ ìœ„ì¹˜ ì¶”ì  ì‹œì‘
export const startLocationSharing = async (
  userId: string,
  familyIds: string[]
) => {
  // ì‚¬ìš©ìì˜ ìœ„ì¹˜ë¥¼ 5ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
  const locationInterval = setInterval(async () => {
    const position = await getCurrentPosition();

    // DBì— ìœ„ì¹˜ ì €ì¥
    await supabase.from('taxi_location_tracking').insert({
      taxi_call_id: currentTaxiCallId,
      latitude: position.coords.latitude,
      longitude: position.coords.longitude
    });

    // Realtimeìœ¼ë¡œ ê°€ì¡±ë“¤ì—ê²Œ ì‹¤ì‹œê°„ ì „ì†¡
    await supabase.from('taxi_location_tracking').on('INSERT', payload => {
      // ê°€ì¡± ì•±ì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ìœ„ì¹˜ ì—…ë°ì´íŠ¸ ë°›ìŒ
    }).subscribe();
  }, 5000);

  return locationInterval;
};

// ìœ„ì¹˜ ê³µìœ  ì¢…ë£Œ
export const stopLocationSharing = async (intervalId: NodeJS.Timeout) => {
  clearInterval(intervalId);
};
```

---

## Phase 2 í™•ì¥ ê³„íš

### ì•± ë‚´ ì§ì ‘ í˜¸ì¶œ (Kakao Mobility API)
```typescript
// ì¹´ì¹´ì˜¤ ëª¨ë¹Œë¦¬í‹° API ì§ì ‘ ì—°ë™
const callTaxiDirect = async (params: TaxiCallParams) => {
  const response = await fetch('https://apis-navi.kakaomobility.com/v1/taxi/call', {
    method: 'POST',
    headers: {
      'Authorization': `KakaoAK ${process.env.KAKAO_MOBILITY_API_KEY}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      origin: {
        x: params.startX,
        y: params.startY
      },
      destination: {
        x: params.endX,
        y: params.endY
      },
      payment: 'card', // ìë™ ê²°ì œ
      user_info: {
        phone: params.userPhone
      }
    })
  });

  const data = await response.json();
  return data; // íƒì‹œ ë°°ì°¨ ì •ë³´, ë„ì°© ì˜ˆì • ì‹œê°„ ë“±
};
```

### ìë™ ê²°ì œ ì—°ë™
- ì¹´ë“œ ë“±ë¡
- ê°€ì¡± ì¹´ë“œë¡œ ê²°ì œ
- ì˜ìˆ˜ì¦ ìë™ ê³µìœ 

---

**ì‘ì„±ì¼**: 2025-01-24
**ë²„ì „**: 1.0
