# Phase 3 - ê¸€ë¡œë²Œ í™•ì¥ & ë‹¤êµ­ì–´ ì§€ì›
## ê¸°ëŠ¥ ìƒì„¸ ê¸°íšì„œ

> **ê°œë°œ ìš°ì„ ìˆœìœ„**: â­â­â­ (ìµœìš°ì„ )
> **ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 12ì£¼
> **ë‹´ë‹¹**: Frontend 3ëª… + Backend 2ëª… + ë²ˆì—­ ì „ë¬¸ê°€

---

## ëª©í‘œ ì‹œì¥

### 1ë‹¨ê³„: ì•„ì‹œì•„ (6ê°œì›”)
```typescript
const PHASE_1_MARKETS = {
  japan: {
    language: 'ì¼ë³¸ì–´ (ja)',
    currency: 'JPY (Â¥)',
    population_65_plus: '29.1%',
    market_size: 'ë§¤ìš° í¼',
    key_features: ['K-DOC ì›ê²©ì§„ë£Œ', 'ë°”ì•¼ë‹¤ ê°„í˜¸', 'AI ì¬í™œ']
  },

  taiwan: {
    language: 'ì¤‘êµ­ì–´ ë²ˆì²´ (zh-TW)',
    currency: 'TWD (NT$)',
    population_65_plus: '17.6%',
    market_size: 'ì¤‘ê°„',
    key_features: ['ê±´ê°• ê´€ë¦¬', 'ì‹ë‹¨', 'íƒì‹œ']
  },

  singapore: {
    language: 'ì˜ì–´ (en-SG)',
    currency: 'SGD (S$)',
    population_65_plus: '15.2%',
    market_size: 'ì¤‘ê°„ (ê³ ì†Œë“)',
    key_features: ['ì „ì²´ ì„œë¹„ìŠ¤']
  }
};
```

### 2ë‹¨ê³„: ë¶ë¯¸/ìœ ëŸ½ (12ê°œì›”)
```typescript
const PHASE_2_MARKETS = {
  usa: {
    language: 'ì˜ì–´ (en-US)',
    currency: 'USD ($)',
    population_65_plus: '16.9%',
    market_size: 'ë§¤ìš° í¼',
    partnerships: ['Medicare', 'Private Insurance']
  },

  canada: {
    language: ['ì˜ì–´ (en-CA)', 'ë¶ˆì–´ (fr-CA)'],
    currency: 'CAD (C$)',
    population_65_plus: '18.5%'
  },

  uk: {
    language: 'ì˜ì–´ (en-GB)',
    currency: 'GBP (Â£)',
    healthcare: 'NHS ì—°ë™'
  }
};
```

---

## ë‹¤êµ­ì–´ ì§€ì› (i18n)

### next-intl ì„¤ì • í™•ì¥

```typescript
// i18n.config.ts
export const locales = [
  'ko',    // í•œêµ­ì–´ (ê¸°ë³¸)
  'en',    // ì˜ì–´
  'ja',    // ì¼ë³¸ì–´
  'zh-TW', // ì¤‘êµ­ì–´ ë²ˆì²´ (ëŒ€ë§Œ)
  'zh-CN', // ì¤‘êµ­ì–´ ê°„ì²´
  'vi',    // ë² íŠ¸ë‚¨ì–´
  'th',    // íƒœêµ­ì–´
  'es',    // ìŠ¤í˜ì¸ì–´
  'fr',    // í”„ë‘ìŠ¤ì–´
  'de'     // ë…ì¼ì–´
] as const;

export type Locale = (typeof locales)[number];

export const defaultLocale: Locale = 'ko';

// ì–¸ì–´ë³„ ì„¤ì •
export const localeConfig = {
  ko: {
    name: 'í•œêµ­ì–´',
    flag: 'ğŸ‡°ğŸ‡·',
    currency: 'KRW',
    dateFormat: 'YYYYë…„ MMì›” DDì¼',
    numberFormat: '1,000ì›'
  },
  en: {
    name: 'English',
    flag: 'ğŸ‡ºğŸ‡¸',
    currency: 'USD',
    dateFormat: 'MM/DD/YYYY',
    numberFormat: '$1,000'
  },
  ja: {
    name: 'æ—¥æœ¬èª',
    flag: 'ğŸ‡¯ğŸ‡µ',
    currency: 'JPY',
    dateFormat: 'YYYYå¹´MMæœˆDDæ—¥',
    numberFormat: 'Â¥1,000'
  },
  'zh-TW': {
    name: 'ç¹é«”ä¸­æ–‡',
    flag: 'ğŸ‡¹ğŸ‡¼',
    currency: 'TWD',
    dateFormat: 'YYYYå¹´MMæœˆDDæ—¥',
    numberFormat: 'NT$1,000'
  }
};
```

### ë²ˆì—­ íŒŒì¼ êµ¬ì¡°

```
messages/
â”œâ”€â”€ ko.json           # í•œêµ­ì–´ (ê¸°ë³¸)
â”œâ”€â”€ en.json           # ì˜ì–´
â”œâ”€â”€ ja.json           # ì¼ë³¸ì–´
â”œâ”€â”€ zh-TW.json        # ì¤‘êµ­ì–´ ë²ˆì²´
â””â”€â”€ ...

ê° íŒŒì¼ êµ¬ì¡°:
{
  "common": {
    "app_name": "ì‹œë‹ˆì–´ í™ˆì¼€ì–´",
    "welcome": "í™˜ì˜í•©ë‹ˆë‹¤",
    "loading": "ë¡œë”© ì¤‘...",
    ...
  },
  "health": {
    "medication": "ë³µì•½ ê´€ë¦¬",
    "take_medicine": "ì•½ ë³µìš©í•˜ê¸°",
    ...
  },
  "food": {
    "meal_log": "ì‹ë‹¨ ê¸°ë¡",
    "breakfast": "ì•„ì¹¨",
    ...
  },
  ...
}
```

### ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©

```typescript
// app/[locale]/health/medication/page.tsx
import { useTranslations } from 'next-intl';

export default function MedicationPage() {
  const t = useTranslations('health');

  return (
    <div>
      <h1>{t('medication')}</h1>
      <button>{t('take_medicine')}</button>
    </div>
  );
}
```

---

## ì§€ì—­í™” (Localization)

### 1. ë‚ ì§œ/ì‹œê°„ í˜•ì‹

```typescript
import { format } from 'date-fns';
import { ko, ja, enUS, zhTW } from 'date-fns/locale';

const localeMap = {
  ko,
  ja,
  en: enUS,
  'zh-TW': zhTW
};

export const formatLocalizedDate = (
  date: Date,
  locale: Locale,
  formatStr: string = 'PPP'
) => {
  return format(date, formatStr, {
    locale: localeMap[locale]
  });
};

// ì‚¬ìš© ì˜ˆ
formatLocalizedDate(new Date(), 'ko', 'PPP')
// â†’ "2025ë…„ 2ì›” 20ì¼"

formatLocalizedDate(new Date(), 'ja', 'PPP')
// â†’ "2025å¹´2æœˆ20æ—¥"
```

### 2. ìˆ«ì/í†µí™” í˜•ì‹

```typescript
export const formatCurrency = (
  amount: number,
  locale: Locale
) => {
  const config = localeConfig[locale];

  return new Intl.NumberFormat(locale, {
    style: 'currency',
    currency: config.currency
  }).format(amount);
};

// ì‚¬ìš© ì˜ˆ
formatCurrency(10000, 'ko')  // â†’ "â‚©10,000"
formatCurrency(10000, 'en')  // â†’ "$10,000.00"
formatCurrency(10000, 'ja')  // â†’ "Â¥10,000"
```

### 3. ë‹¨ìœ„ ë³€í™˜

```typescript
// í•œêµ­: kg, km, cm
// ë¯¸êµ­: lb, mile, inch

export const formatWeight = (kg: number, locale: Locale) => {
  if (locale === 'en' && localeConfig[locale].country === 'US') {
    const lb = kg * 2.20462;
    return `${lb.toFixed(1)} lb`;
  }
  return `${kg} kg`;
};

export const formatDistance = (km: number, locale: Locale) => {
  if (locale === 'en' && localeConfig[locale].country === 'US') {
    const miles = km * 0.621371;
    return `${miles.toFixed(1)} mi`;
  }
  return `${km} km`;
};
```

---

## êµ­ê°€ë³„ ê¸°ëŠ¥ ì¡°ì •

### 1. ê²°ì œ ì‹œìŠ¤í…œ

```typescript
const paymentProviders = {
  kr: ['í† ìŠ¤í˜ì´ë¨¼ì¸ ', 'ë„¤ì´ë²„í˜ì´', 'ì¹´ì¹´ì˜¤í˜ì´'],
  jp: ['Stripe', 'PayPay', 'Rakuten Pay'],
  us: ['Stripe', 'PayPal', 'Square'],
  tw: ['Stripe', 'LINE Pay', 'JKO Pay']
};

export const getAvailablePaymentMethods = (country: string) => {
  return paymentProviders[country] || ['Stripe'];
};
```

### 2. í—¬ìŠ¤ì¼€ì–´ ì‹œìŠ¤í…œ ì—°ë™

```typescript
const healthcarePartners = {
  kr: {
    hospital_booking: ['êµ¿ë‹¥', 'ë‹¥í„°ë‚˜ìš°'],
    telemedicine: ['K-DOC'],
    home_care: ['ë°”ì•¼ë‹¤']
  },
  jp: {
    hospital_booking: ['Medical Note'],
    telemedicine: ['CLINICS'],
    home_care: ['Sompo Care']
  },
  us: {
    hospital_booking: ['Zocdoc'],
    telemedicine: ['Teladoc', 'MDLive'],
    home_care: ['Bayada Global', 'Home Instead']
  }
};
```

### 3. ì‹ìì¬/ë°°ë‹¬ ì„œë¹„ìŠ¤

```typescript
const foodDeliveryPartners = {
  kr: ['ë°°ë‹¬ì˜ë¯¼ì¡±', 'ì¿ íŒ¡ì´ì¸ ', 'ì‹œë‹ˆì–´ ë„ì‹œë½ ì—…ì²´'],
  jp: ['Uber Eats', 'Demae-can', 'ã‚·ãƒ‹ã‚¢ã®ã”ã¯ã‚“'],
  us: ['DoorDash', 'Uber Eats', 'Mom\'s Meals'],
  sg: ['Grab Food', 'foodpanda']
};
```

---

## ë¬¸í™”ì  ê³ ë ¤ì‚¬í•­

### 1. ì¼ë³¸ ì‹œì¥

```typescript
// ì¼ë³¸ì–´ ì¡´ëŒ“ë§ ì‚¬ìš©
const japaneseMessages = {
  "welcome": "ã‚ˆã†ã“ã",
  "medication_reminder": "ãŠè–¬ã®æ™‚é–“ã§ã™", // ì¡´ëŒ“ë§
  "take_medicine": "ãŠè–¬ã‚’é£²ã‚“ã§ãã ã•ã„",  // ì •ì¤‘í•œ ëª…ë ¹í˜•
  ...
};

// ì¼ë³¸ì‹ ê±´ê°• ê´€ë¦¬ ìš©ì–´
{
  "blood_pressure": "è¡€åœ§",
  "blood_sugar": "è¡€ç³–å€¤",
  "medication": "æœè–¬",
  "hospital": "ç—…é™¢"
}
```

### 2. ë¯¸êµ­ ì‹œì¥

```typescript
// HIPAA ì¤€ìˆ˜ (ì˜ë£Œ ì •ë³´ ë³´í˜¸ë²•)
const hipaaCompliance = {
  encryption: true,
  audit_logs: true,
  user_consent: true,
  data_retention_policy: '7 years'
};

// ì˜ì–´ ë©”ì‹œì§€ (ê°„ê²°í•˜ê³  ì¹œê·¼í•˜ê²Œ)
const englishMessages = {
  "welcome": "Welcome!",
  "medication_reminder": "Time for your meds",
  "take_medicine": "Take medication",
  ...
};
```

### 3. ëŒ€ë§Œ ì‹œì¥

```typescript
// ë²ˆì²´ ì¤‘êµ­ì–´ ì‚¬ìš©
const taiwaneseMessages = {
  "welcome": "æ­¡è¿",
  "medication": "æœè—¥ç®¡ç†",
  "health_record": "å¥åº·ç´€éŒ„",
  ...
};

// ëŒ€ë§Œ ê±´ê°•ë³´í—˜ (NHI) ì—°ë™
const nhiIntegration = {
  card_number: 'NHI Card Number',
  clinic_code: 'Clinic Code'
};
```

---

## DB ìŠ¤í‚¤ë§ˆ (ë‹¤êµ­ì–´ ì§€ì›)

```sql
-- ì‚¬ìš©ì ì„ í˜¸ ì–¸ì–´
ALTER TABLE users ADD COLUMN preferred_locale VARCHAR(10) DEFAULT 'ko';
ALTER TABLE users ADD COLUMN country_code VARCHAR(3);
ALTER TABLE users ADD COLUMN timezone VARCHAR(50) DEFAULT 'Asia/Seoul';

-- ë‹¤êµ­ì–´ ì½˜í…ì¸  (ì˜ˆ: ì•½ ì´ë¦„)
CREATE TABLE medication_translations (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  medication_id UUID NOT NULL REFERENCES medications(id),
  locale VARCHAR(10) NOT NULL,
  name VARCHAR(200) NOT NULL,
  description TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),

  UNIQUE(medication_id, locale)
);

-- ì„œë¹„ìŠ¤ ì œê³µ êµ­ê°€
CREATE TABLE supported_countries (
  code VARCHAR(3) PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  locales TEXT[] NOT NULL,
  currency VARCHAR(3) NOT NULL,
  active BOOLEAN DEFAULT true,
  launch_date DATE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

---

## API ì—”ë“œí¬ì¸íŠ¸

### ì–¸ì–´ ê°ì§€ ë° ì„¤ì •

```typescript
// GET /api/locale/detect
export async function GET(req: Request) {
  // Accept-Language í—¤ë”ì—ì„œ ì„ í˜¸ ì–¸ì–´ ê°ì§€
  const acceptLanguage = req.headers.get('accept-language');
  const detectedLocale = detectLocale(acceptLanguage);

  // IP ê¸°ë°˜ êµ­ê°€ ê°ì§€
  const clientIp = req.headers.get('x-forwarded-for');
  const country = await detectCountry(clientIp);

  return Response.json({
    success: true,
    data: {
      detected_locale: detectedLocale,
      country_code: country,
      supported: locales.includes(detectedLocale)
    }
  });
}

// PATCH /api/users/:id/locale
export async function PATCH(
  req: Request,
  { params }: { params: { id: string } }
) {
  const { locale, country, timezone } = await req.json();

  const { data: user } = await supabase
    .from('users')
    .update({
      preferred_locale: locale,
      country_code: country,
      timezone
    })
    .eq('id', params.id)
    .select()
    .single();

  return Response.json({ success: true, data: user });
}
```

---

## ë²ˆì—­ ì›Œí¬í”Œë¡œìš°

### 1. ë²ˆì—­ ê´€ë¦¬ ë„êµ¬

```typescript
// Crowdin, Phrase, Lokalise ë“± ì‚¬ìš©

// ë²ˆì—­ í‚¤ ì¶”ì¶œ
const extractTranslationKeys = async () => {
  // ì†ŒìŠ¤ ì½”ë“œì—ì„œ t() í˜¸ì¶œ ì°¾ê¸°
  // ë²ˆì—­ íŒŒì¼ê³¼ ë¹„êµí•˜ì—¬ ëˆ„ë½ëœ í‚¤ ì°¾ê¸°
  // CSV ë˜ëŠ” JSONìœ¼ë¡œ export
};

// ë²ˆì—­ ê²€ì¦
const validateTranslations = (locale: Locale) => {
  const baseKeys = Object.keys(messages['ko']);
  const localeKeys = Object.keys(messages[locale]);

  const missingKeys = baseKeys.filter(
    key => !localeKeys.includes(key)
  );

  if (missingKeys.length > 0) {
    console.warn(`Missing translations in ${locale}:`, missingKeys);
  }
};
```

### 2. ë²ˆì—­ QA í”„ë¡œì„¸ìŠ¤

```
1. ê°œë°œì: í•œêµ­ì–´ë¡œ ê¸°ëŠ¥ ê°œë°œ
2. ì¶”ì¶œ: ë²ˆì—­ í‚¤ ìë™ ì¶”ì¶œ
3. ë²ˆì—­: ì „ë¬¸ ë²ˆì—­ê°€ì—ê²Œ ì˜ë¢°
4. ê²€ìˆ˜: ë„¤ì´í‹°ë¸Œ ìŠ¤í”¼ì»¤ ê²€ìˆ˜
5. í†µí•©: ë²ˆì—­ íŒŒì¼ merge
6. í…ŒìŠ¤íŠ¸: ê° ì–¸ì–´ë³„ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
```

---

## í…ŒìŠ¤íŠ¸

### ë‹¤êµ­ì–´ E2E í…ŒìŠ¤íŠ¸

```typescript
// tests/i18n.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Internationalization', () => {
  test('should display Japanese interface', async ({ page }) => {
    await page.goto('/ja');

    // ë©”ì¸ íƒ€ì´í‹€ì´ ì¼ë³¸ì–´ë¡œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
    const title = await page.textContent('h1');
    expect(title).toBe('ã‚ˆã†ã“ã');

    // ë³µì•½ ê´€ë¦¬ í˜ì´ì§€
    await page.click('text=æœè–¬ç®¡ç†');
    expect(await page.textContent('h2')).toBe('ãŠè–¬ãƒªã‚¹ãƒˆ');
  });

  test('should format currency correctly', async ({ page }) => {
    await page.goto('/en');

    // ë¯¸êµ­ ë‹¬ëŸ¬ë¡œ í‘œì‹œ
    const price = await page.textContent('.price');
    expect(price).toMatch(/\$\d+\.\d{2}/);
  });
});
```

---

## ì¶œì‹œ ì „ëµ

### ì‹œì¥ë³„ ì¶œì‹œ ì¼ì •

```typescript
const launchSchedule = {
  '2025-08': {
    countries: ['KR'], // í•œêµ­ (ì´ë¯¸ ì¶œì‹œ)
    status: 'live'
  },
  '2025-12': {
    countries: ['JP', 'TW', 'SG'],
    status: 'preparing',
    tasks: [
      'í˜„ì§€ íŒŒíŠ¸ë„ˆì‚¬ ê³„ì•½',
      'ë²ˆì—­ ì™„ë£Œ',
      'ê²°ì œ ì‹œìŠ¤í…œ ì—°ë™',
      'ë² íƒ€ í…ŒìŠ¤íŠ¸'
    ]
  },
  '2026-06': {
    countries: ['US', 'CA'],
    status: 'planned',
    requirements: [
      'HIPAA ì¸ì¦',
      'FDA ìŠ¹ì¸ (í•„ìš” ì‹œ)',
      'Medicare/Medicaid ì—°ë™'
    ]
  }
};
```

---

**ì‘ì„±ì¼**: 2025-01-24
**ë²„ì „**: 1.0
**ë‹¤ìŒ ë¬¸ì„œ**: 03-DKSH-ë¬¼ë¥˜-ìë™í™”.md
