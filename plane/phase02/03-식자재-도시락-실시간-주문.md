# Phase 2 - ì‹ìì¬/ë„ì‹œë½ ì‹¤ì‹œê°„ ì£¼ë¬¸
## ê¸°ëŠ¥ ìƒì„¸ ê¸°íšì„œ

> **ê°œë°œ ìš°ì„ ìˆœìœ„**: â­â­â­ (ìµœìš°ì„ )
> **ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 5ì£¼
> **ë‹´ë‹¹**: Frontend 2ëª… + Backend 2ëª…
> **íŒŒíŠ¸ë„ˆ**: ì‹œë‹ˆì–´ ë„ì‹œë½ ì—…ì²´, ë°‘ë°˜ì°¬ ì—…ì²´, ë°°ë‹¬ì˜ë¯¼ì¡±/ì¿ íŒ¡ì´ì¸ 

---

## ê¸°ëŠ¥ ê°œìš”

### Phase 1 vs Phase 2
- **Phase 1**: ì—…ì²´ ì •ë³´ ì œê³µ + ì „í™” ì£¼ë¬¸ ì•ˆë‚´
- **Phase 2**: **ì•± ë‚´ ì‹¤ì‹œê°„ ì£¼ë¬¸ + ìë™ ê²°ì œ + ë°°ë‹¬ ì¶”ì **

### í•µì‹¬ ê°€ì¹˜
- ì „í™” ì—†ì´ **ì›í´ë¦­ ì£¼ë¬¸**
- ì‹¤ì‹œê°„ ì¬ê³  í™•ì¸ ë° ë°°ë‹¬ ì‹œê°„ ì•ˆë‚´
- ìë™ ê²°ì œ ë° ì£¼ë¬¸ í™•ì •
- ë°°ë‹¬ ì‹¤ì‹œê°„ ì¶”ì 

---

## ì£¼ë¬¸ í”Œë¡œìš°

### 1. ë©”ë‰´ ì„ íƒ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì‹¤ë²„ê±´ê°•ë„ì‹œë½                     â”‚
â”‚  â­â­â­â­â­ 4.9 (328ê°œ)          â”‚
â”‚                                      â”‚
â”‚  ğŸšš ì˜¤ëŠ˜ ì˜¤ì „ 11ì‹œê¹Œì§€ ë°°ë‹¬ ê°€ëŠ¥   â”‚
â”‚  ğŸ“ ë°°ë‹¬ë¹„ ë¬´ë£Œ                     â”‚
â”‚                                      â”‚
â”‚  â”â”â” ì˜¤ëŠ˜ì˜ ë©”ë‰´ â”â”â”               â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ ê±´ê°• ë„ì‹œë½ A       â”‚             â”‚
â”‚  â”‚ [ì‚¬ì§„]             â”‚             â”‚
â”‚  â”‚                    â”‚             â”‚
â”‚  â”‚ â€¢ í°ìŒ€ë°¥           â”‚             â”‚
â”‚  â”‚ â€¢ ë‘ë¶€êµ¬ì´         â”‚             â”‚
â”‚  â”‚ â€¢ ì‹œê¸ˆì¹˜ë‚˜ë¬¼       â”‚             â”‚
â”‚  â”‚ â€¢ ëœì¥ì°Œê°œ         â”‚             â”‚
â”‚  â”‚ â€¢ ë°°ì¶”ê¹€ì¹˜         â”‚             â”‚
â”‚  â”‚                    â”‚             â”‚
â”‚  â”‚ 550kcal            â”‚             â”‚
â”‚  â”‚ ë‚˜íŠ¸ë¥¨ 1,800mg     â”‚             â”‚
â”‚  â”‚                    â”‚             â”‚
â”‚  â”‚ 9,000ì›            â”‚             â”‚
â”‚  â”‚ [+ ë‹´ê¸°]           â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ ê±´ê°• ë„ì‹œë½ B       â”‚             â”‚
â”‚  â”‚ (ë‹¹ë‡¨ì‹)           â”‚             â”‚
â”‚  â”‚ [ì‚¬ì§„]             â”‚             â”‚
â”‚  â”‚                    â”‚             â”‚
â”‚  â”‚ â€¢ í˜„ë¯¸ë°¥           â”‚             â”‚
â”‚  â”‚ â€¢ ë‹­ê°€ìŠ´ì‚´         â”‚             â”‚
â”‚  â”‚ â€¢ ë¸Œë¡œì½œë¦¬         â”‚             â”‚
â”‚  â”‚ â€¢ ë¯¸ì—­êµ­           â”‚             â”‚
â”‚  â”‚                    â”‚             â”‚
â”‚  â”‚ 480kcal            â”‚             â”‚
â”‚  â”‚ ë‹¹ì§ˆ 55g           â”‚             â”‚
â”‚  â”‚                    â”‚             â”‚
â”‚  â”‚ 10,000ì›           â”‚             â”‚
â”‚  â”‚ [+ ë‹´ê¸°]           â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                      â”‚
â”‚  [ì¥ë°”êµ¬ë‹ˆ 0ê°œ]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ì •ê¸° ë°°ì†¡ ì„¤ì • (ì„ íƒ)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì •ê¸° ë°°ì†¡ ì„¤ì •                      â”‚
â”‚                                      â”‚
â”‚  ë§¤ì¼ ê°™ì€ ë©”ë‰´ë¥¼ ìë™ìœ¼ë¡œ          â”‚
â”‚  ì£¼ë¬¸í•˜ì‹œê² ì–´ìš”?                     â”‚
â”‚                                      â”‚
â”‚  ğŸ’° ì •ê¸° ë°°ì†¡ ì‹œ 10% í• ì¸!          â”‚
â”‚                                      â”‚
â”‚  ë°°ì†¡ ì£¼ê¸° ì„ íƒ:                     â”‚
â”‚  â—‰ ì¼íšŒ ì£¼ë¬¸ë§Œ                      â”‚
â”‚  â—‹ ë§¤ì¼ (ì›”~ê¸ˆ) - 10% í• ì¸         â”‚
â”‚  â—‹ ì£¼ 3íšŒ (ì›”, ìˆ˜, ê¸ˆ) - 7% í• ì¸  â”‚
â”‚  â—‹ ì£¼ 2íšŒ (í™”, ëª©) - 5% í• ì¸      â”‚
â”‚                                      â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”‚
â”‚                                      â”‚
â”‚  ì •ê¸° ë°°ì†¡ ê¸°ê°„:                     â”‚
â”‚  â—‹ 1ê°œì›”                            â”‚
â”‚  â—‹ 3ê°œì›” (ì¶”ê°€ 5% í• ì¸)            â”‚
â”‚  â—‹ 6ê°œì›” (ì¶”ê°€ 10% í• ì¸)           â”‚
â”‚                                      â”‚
â”‚  [ì¼íšŒ ì£¼ë¬¸í•˜ê¸°] [ì •ê¸° ë°°ì†¡ ì‹ ì²­]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. ì¥ë°”êµ¬ë‹ˆ ë° ì£¼ë¬¸
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì¥ë°”êµ¬ë‹ˆ                            â”‚
â”‚                                      â”‚
â”‚  ì‹¤ë²„ê±´ê°•ë„ì‹œë½                     â”‚
â”‚                                      â”‚
â”‚  ê±´ê°• ë„ì‹œë½ A  Ã—  2ê°œ              â”‚
â”‚  9,000ì› Ã— 2 = 18,000ì›             â”‚
â”‚  [- 1 +] [ì‚­ì œ]                     â”‚
â”‚                                      â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”‚
â”‚                                      â”‚
â”‚  ë°°ë‹¬ ì •ë³´                           â”‚
â”‚                                      â”‚
â”‚  ì£¼ì†Œ:                               â”‚
â”‚  ì„œìš¸ì‹œ ê°•ë™êµ¬ ì²œí˜¸ë™ 123-45        â”‚
â”‚  101ë™ 1001í˜¸                       â”‚
â”‚  [ë³€ê²½]                             â”‚
â”‚                                      â”‚
â”‚  ì—°ë½ì²˜:                             â”‚
â”‚  010-1234-5678                      â”‚
â”‚  [ë³€ê²½]                             â”‚
â”‚                                      â”‚
â”‚  ë°°ë‹¬ ìš”ì²­ì‚¬í•­ (ì„ íƒ):               â”‚
â”‚  [ë¬¸ ì•ì— ë†“ì•„ì£¼ì„¸ìš”]               â”‚
â”‚                                      â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”‚
â”‚                                      â”‚
â”‚  ë°°ë‹¬ ì‹œê°„:                          â”‚
â”‚  â—‰ ì˜¤ì „ 11ì‹œê¹Œì§€                   â”‚
â”‚  â—‹ ì˜¤í›„ 6ì‹œê¹Œì§€                    â”‚
â”‚                                      â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”‚
â”‚                                      â”‚
â”‚  ìƒí’ˆ ê¸ˆì•¡:       18,000ì›          â”‚
â”‚  ë°°ë‹¬ë¹„:              ë¬´ë£Œ           â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”‚
â”‚  ì´ ê²°ì œ ê¸ˆì•¡:    18,000ì›          â”‚
â”‚                                      â”‚
â”‚  ğŸ’³ ê²°ì œ ìˆ˜ë‹¨                       â”‚
â”‚  [KBêµ­ë¯¼ì¹´ë“œ ****1234 â–¼]           â”‚
â”‚                                      â”‚
â”‚  [18,000ì› ê²°ì œí•˜ê³  ì£¼ë¬¸í•˜ê¸°]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. ì£¼ë¬¸ ì™„ë£Œ ë° ë°°ë‹¬ ì¶”ì 
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… ì£¼ë¬¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!          â”‚
â”‚                                      â”‚
â”‚  ì£¼ë¬¸ë²ˆí˜¸: FO2025022501             â”‚
â”‚                                      â”‚
â”‚  â”â”â” ì£¼ë¬¸ ì •ë³´ â”â”â”                 â”‚
â”‚                                      â”‚
â”‚  ì‹¤ë²„ê±´ê°•ë„ì‹œë½                     â”‚
â”‚  ê±´ê°• ë„ì‹œë½ A Ã— 2ê°œ                â”‚
â”‚                                      â”‚
â”‚  ë°°ë‹¬ ì˜ˆì •: ì˜¤ëŠ˜ ì˜¤ì „ 11ì‹œ          â”‚
â”‚                                      â”‚
â”‚  â”â”â” ë°°ë‹¬ í˜„í™© â”â”â”                 â”‚
â”‚                                      â”‚
â”‚  ğŸ”µ ì£¼ë¬¸ ì ‘ìˆ˜ ì™„ë£Œ (09:15)          â”‚
â”‚  âšª ì¡°ë¦¬ ì¤‘                         â”‚
â”‚  âšª ë°°ë‹¬ ì¤‘                         â”‚
â”‚  âšª ë°°ë‹¬ ì™„ë£Œ                       â”‚
â”‚                                      â”‚
â”‚  ì˜ˆìƒ ë°°ë‹¬ ì‹œê°„: 10:50              â”‚
â”‚                                      â”‚
â”‚  [ì‹¤ì‹œê°„ ë°°ë‹¬ ì¶”ì ]                 â”‚
â”‚  [ì—…ì²´ì— ì „í™”í•˜ê¸°]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â†“ ì¡°ë¦¬ ì‹œì‘

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ë°°ë‹¬ í˜„í™©                           â”‚
â”‚                                      â”‚
â”‚  ğŸ”µ ì£¼ë¬¸ ì ‘ìˆ˜ ì™„ë£Œ (09:15)          â”‚
â”‚  ğŸ”µ ì¡°ë¦¬ ì¤‘ (09:30)                 â”‚
â”‚  âšª ë°°ë‹¬ ì¤‘                         â”‚
â”‚  âšª ë°°ë‹¬ ì™„ë£Œ                       â”‚
â”‚                                      â”‚
â”‚  í˜„ì¬ ë„ì‹œë½ì„ ì¡°ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤    â”‚
â”‚  ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â†“ ë°°ë‹¬ ì‹œì‘

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ë°°ë‹¬ í˜„í™©                           â”‚
â”‚                                      â”‚
â”‚  ğŸ”µ ì£¼ë¬¸ ì ‘ìˆ˜ ì™„ë£Œ (09:15)          â”‚
â”‚  ğŸ”µ ì¡°ë¦¬ ì™„ë£Œ (10:20)               â”‚
â”‚  ğŸ”µ ë°°ë‹¬ ì¤‘ (10:25)                 â”‚
â”‚  âšª ë°°ë‹¬ ì™„ë£Œ                       â”‚
â”‚                                      â”‚
â”‚  [ì§€ë„ í‘œì‹œ]                        â”‚
â”‚  ğŸ“ ì‹¤ì‹œê°„ ë°°ë‹¬ ìœ„ì¹˜                â”‚
â”‚                                      â”‚
â”‚  ë°°ë‹¬ ê¸°ì‚¬: ê¹€â—‹â—‹                   â”‚
â”‚  ì°¨ëŸ‰ ë²ˆí˜¸: 12ê°€3456                â”‚
â”‚                                      â”‚
â”‚  ì˜ˆìƒ ë„ì°©: 10:50 (25ë¶„ ë‚¨ìŒ)       â”‚
â”‚                                      â”‚
â”‚  [ë°°ë‹¬ ê¸°ì‚¬ì—ê²Œ ì „í™”]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â†“ ë°°ë‹¬ ì™„ë£Œ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… ë°°ë‹¬ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!          â”‚
â”‚                                      â”‚
â”‚  ë§›ìˆê²Œ ë“œì„¸ìš”! ğŸ˜Š                  â”‚
â”‚                                      â”‚
â”‚  ë°°ë‹¬ ì™„ë£Œ ì‹œê°„: 10:47              â”‚
â”‚                                      â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”‚
â”‚                                      â”‚
â”‚  ì„œë¹„ìŠ¤ëŠ” ì–´ë– ì…¨ë‚˜ìš”?               â”‚
â”‚                                      â”‚
â”‚  â­â­â­â­â­                       â”‚
â”‚                                      â”‚
â”‚  [í›„ê¸° ì‘ì„±í•˜ê¸°]                    â”‚
â”‚  [ë‹¤ì‹œ ì£¼ë¬¸í•˜ê¸°]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## DB ìŠ¤í‚¤ë§ˆ

```sql
-- ì‹ìì¬/ë„ì‹œë½ ì—…ì²´ (Phase 1ì—ì„œ í™•ì¥)
ALTER TABLE food_service_providers ADD COLUMN online_ordering_enabled BOOLEAN DEFAULT false;
ALTER TABLE food_service_providers ADD COLUMN delivery_tracking_enabled BOOLEAN DEFAULT false;

-- ë©”ë‰´ ì•„ì´í…œ (Phase 1ì—ì„œ í™•ì¥)
ALTER TABLE provider_menu_items ADD COLUMN stock_quantity INTEGER;
ALTER TABLE provider_menu_items ADD COLUMN available_today BOOLEAN DEFAULT true;

-- ì£¼ë¬¸
CREATE TABLE food_orders (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  order_number VARCHAR(50) UNIQUE NOT NULL,
  user_id UUID NOT NULL REFERENCES users(id),
  provider_id UUID NOT NULL REFERENCES food_service_providers(id),

  -- ì£¼ë¬¸ í•­ëª©
  items JSONB NOT NULL,
  -- [{"menu_item_id": "xxx", "name": "ê±´ê°•ë„ì‹œë½A", "quantity": 2, "price": 9000}]

  -- ë°°ë‹¬ ì •ë³´
  delivery_address TEXT NOT NULL,
  delivery_address_detail TEXT,
  delivery_phone VARCHAR(20) NOT NULL,
  delivery_request TEXT,
  delivery_time_preference VARCHAR(50), -- 'morning', 'evening'

  -- ê¸ˆì•¡
  subtotal INTEGER NOT NULL,
  delivery_fee INTEGER DEFAULT 0,
  discount_amount INTEGER DEFAULT 0,
  total_amount INTEGER NOT NULL,

  -- ê²°ì œ
  payment_method VARCHAR(50),
  payment_id VARCHAR(100),
  paid_at TIMESTAMP WITH TIME ZONE,

  -- ìƒíƒœ
  status VARCHAR(20) DEFAULT 'pending',
  -- 'pending', 'confirmed', 'preparing', 'delivering', 'delivered', 'cancelled'

  -- ë°°ë‹¬ ì¶”ì 
  driver_name VARCHAR(100),
  driver_phone VARCHAR(20),
  driver_vehicle_number VARCHAR(20),
  driver_latitude DECIMAL(10, 8),
  driver_longitude DECIMAL(11, 8),
  last_location_update TIMESTAMP WITH TIME ZONE,

  -- íƒ€ì„ìŠ¤íƒ¬í”„
  confirmed_at TIMESTAMP WITH TIME ZONE,
  preparing_at TIMESTAMP WITH TIME ZONE,
  delivering_at TIMESTAMP WITH TIME ZONE,
  delivered_at TIMESTAMP WITH TIME ZONE,

  -- í‰ê°€
  rating INTEGER,
  review TEXT,
  review_created_at TIMESTAMP WITH TIME ZONE,

  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ì •ê¸° ë°°ì†¡ êµ¬ë…
CREATE TABLE food_subscriptions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id),
  provider_id UUID NOT NULL REFERENCES food_service_providers(id),

  -- êµ¬ë… ì •ë³´
  items JSONB NOT NULL,
  frequency VARCHAR(50) NOT NULL, -- 'daily', '3_times_weekly', '2_times_weekly'
  delivery_days TEXT[], -- ['mon', 'wed', 'fri']
  delivery_time_preference VARCHAR(50),

  -- ë°°ë‹¬ ì •ë³´
  delivery_address TEXT NOT NULL,
  delivery_address_detail TEXT,
  delivery_phone VARCHAR(20) NOT NULL,

  -- ê°€ê²©
  base_monthly_amount INTEGER NOT NULL,
  discount_percentage INTEGER DEFAULT 0,
  monthly_amount INTEGER NOT NULL,

  -- êµ¬ë… ê¸°ê°„
  duration_months INTEGER,
  start_date DATE NOT NULL,
  end_date DATE,

  -- ìƒíƒœ
  status VARCHAR(20) DEFAULT 'active',
  -- 'active', 'paused', 'cancelled'

  -- ê²°ì œ
  payment_method VARCHAR(50),
  card_id VARCHAR(100),
  auto_payment BOOLEAN DEFAULT true,

  -- ë‹¤ìŒ ë°°ë‹¬
  next_delivery_date DATE,

  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- êµ¬ë… ë°°ë‹¬ ê¸°ë¡
CREATE TABLE subscription_deliveries (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  subscription_id UUID NOT NULL REFERENCES food_subscriptions(id),
  order_id UUID REFERENCES food_orders(id),
  delivery_date DATE NOT NULL,
  status VARCHAR(20) DEFAULT 'scheduled',
  -- 'scheduled', 'delivered', 'skipped', 'failed'
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

---

## API ì—”ë“œí¬ì¸íŠ¸

### ì£¼ë¬¸ ìƒì„±
```typescript
// POST /api/food-orders
export async function POST(req: Request) {
  const {
    userId,
    providerId,
    items,
    deliveryInfo,
    paymentMethod
  } = await req.json();

  // 1. ì¬ê³  í™•ì¸
  for (const item of items) {
    const menuItem = await supabase
      .from('provider_menu_items')
      .select('stock_quantity, available_today')
      .eq('id', item.menuItemId)
      .single();

    if (!menuItem.data.available_today || menuItem.data.stock_quantity < item.quantity) {
      return Response.json({
        success: false,
        error: {
          code: 'OUT_OF_STOCK',
          message: `${item.name}ì˜ ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤`
        }
      }, { status: 400 });
    }
  }

  // 2. ê¸ˆì•¡ ê³„ì‚°
  const subtotal = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
  const provider = await getProvider(providerId);
  const deliveryFee = provider.delivery_fee || 0;
  const totalAmount = subtotal + deliveryFee;

  // 3. ê²°ì œ ì²˜ë¦¬
  const payment = await processPayment({
    amount: totalAmount,
    method: paymentMethod,
    userId,
    description: `ë„ì‹œë½ ì£¼ë¬¸ - ${provider.name}`
  });

  if (!payment.success) {
    return Response.json({
      success: false,
      error: { code: 'PAYMENT_FAILED', message: 'ê²°ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤' }
    }, { status: 400 });
  }

  // 4. ì£¼ë¬¸ ìƒì„±
  const orderNumber = generateOrderNumber('FO');

  const { data: order } = await supabase
    .from('food_orders')
    .insert({
      order_number: orderNumber,
      user_id: userId,
      provider_id: providerId,
      items: JSON.stringify(items),
      delivery_address: deliveryInfo.address,
      delivery_address_detail: deliveryInfo.addressDetail,
      delivery_phone: deliveryInfo.phone,
      delivery_request: deliveryInfo.request,
      delivery_time_preference: deliveryInfo.timePreference,
      subtotal,
      delivery_fee: deliveryFee,
      total_amount: totalAmount,
      payment_method: paymentMethod,
      payment_id: payment.id,
      paid_at: new Date(),
      status: 'confirmed',
      confirmed_at: new Date()
    })
    .select()
    .single();

  // 5. ì¬ê³  ì°¨ê°
  for (const item of items) {
    await supabase
      .from('provider_menu_items')
      .update({
        stock_quantity: supabase.raw(`stock_quantity - ${item.quantity}`)
      })
      .eq('id', item.menuItemId);
  }

  // 6. ì—…ì²´ì— ì£¼ë¬¸ ì „ì†¡
  await sendOrderToProvider(providerId, order);

  // 7. ì‚¬ìš©ìì—ê²Œ í™•ì¸ ì•Œë¦¼
  await sendNotification({
    userId,
    title: 'âœ… ì£¼ë¬¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤',
    body: `${provider.name} - ${totalAmount.toLocaleString()}ì›`,
    data: {
      type: 'food_order_confirmed',
      orderId: order.id
    }
  });

  // 8. ê°€ì¡±ì—ê²Œ ì•Œë¦¼ (ì„ íƒì )
  await sendFamilyNotifications(userId, {
    title: 'ë„ì‹œë½ ì£¼ë¬¸',
    body: `ì–´ë¨¸ë‹ˆê°€ ${provider.name}ì—ì„œ ë„ì‹œë½ì„ ì£¼ë¬¸í•˜ì…¨ìŠµë‹ˆë‹¤`,
    orderId: order.id
  });

  return Response.json({ success: true, data: order });
}
```

### ë°°ë‹¬ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
```typescript
// PATCH /api/food-orders/:id/location
export async function PATCH(
  req: Request,
  { params }: { params: { id: string } }
) {
  const { latitude, longitude, driverInfo } = await req.json();

  const { data: order } = await supabase
    .from('food_orders')
    .update({
      driver_name: driverInfo?.name,
      driver_phone: driverInfo?.phone,
      driver_vehicle_number: driverInfo?.vehicleNumber,
      driver_latitude: latitude,
      driver_longitude: longitude,
      last_location_update: new Date()
    })
    .eq('id', params.id)
    .select()
    .single();

  // Realtimeìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ ìœ„ì¹˜ ì „ì†¡
  await supabase
    .from('food_orders')
    .update({ updated_at: new Date() })
    .eq('id', params.id);

  return Response.json({ success: true, data: order });
}
```

### ì •ê¸° ë°°ì†¡ êµ¬ë…
```typescript
// POST /api/food-subscriptions
export async function POST(req: Request) {
  const {
    userId,
    providerId,
    items,
    frequency,
    deliveryDays,
    deliveryInfo,
    durationMonths,
    startDate,
    paymentMethod
  } = await req.json();

  // 1. ì›” ë°°ì†¡ íšŸìˆ˜ ê³„ì‚°
  const deliveriesPerMonth = deliveryDays.length * 4;

  // 2. ê¸°ë³¸ ì›” ê¸ˆì•¡ ê³„ì‚°
  const itemTotal = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
  const baseMonthlyAmount = itemTotal * deliveriesPerMonth;

  // 3. í• ì¸ìœ¨ ê³„ì‚°
  let discountPercentage = 0;
  if (frequency === 'daily') discountPercentage = 10;
  else if (frequency === '3_times_weekly') discountPercentage = 7;
  else if (frequency === '2_times_weekly') discountPercentage = 5;

  // ê¸°ê°„ í• ì¸ ì¶”ê°€
  if (durationMonths >= 6) discountPercentage += 10;
  else if (durationMonths >= 3) discountPercentage += 5;

  const monthlyAmount = Math.floor(
    baseMonthlyAmount * (1 - discountPercentage / 100)
  );

  // 4. êµ¬ë… ìƒì„±
  const { data: subscription } = await supabase
    .from('food_subscriptions')
    .insert({
      user_id: userId,
      provider_id: providerId,
      items: JSON.stringify(items),
      frequency,
      delivery_days: deliveryDays,
      delivery_time_preference: deliveryInfo.timePreference,
      delivery_address: deliveryInfo.address,
      delivery_address_detail: deliveryInfo.addressDetail,
      delivery_phone: deliveryInfo.phone,
      base_monthly_amount: baseMonthlyAmount,
      discount_percentage: discountPercentage,
      monthly_amount: monthlyAmount,
      duration_months: durationMonths,
      start_date: startDate,
      end_date: calculateEndDate(startDate, durationMonths),
      payment_method: paymentMethod,
      auto_payment: true,
      next_delivery_date: startDate,
      status: 'active'
    })
    .select()
    .single();

  // 5. ì²« ë‹¬ ê²°ì œ
  await processPayment({
    amount: monthlyAmount,
    method: paymentMethod,
    userId,
    description: `ë„ì‹œë½ ì •ê¸° ë°°ì†¡ (ì²« ë‹¬)`
  });

  // 6. ë°°ë‹¬ ì¼ì • ìƒì„±
  await generateDeliverySchedule(subscription);

  // 7. ì•Œë¦¼
  await sendNotification({
    userId,
    title: 'âœ… ì •ê¸° ë°°ì†¡ì´ ì‹œì‘ë©ë‹ˆë‹¤',
    body: `${deliveryDays.length}íšŒ/ì£¼ ë°°ì†¡, ì›” ${monthlyAmount.toLocaleString()}ì› (${discountPercentage}% í• ì¸)`
  });

  return Response.json({ success: true, data: subscription });
}
```

---

## ë°°ë‹¬ ì¶”ì  Realtime

```typescript
// í´ë¼ì´ì–¸íŠ¸: ì‹¤ì‹œê°„ ìœ„ì¹˜ êµ¬ë…
export const useDeliveryTracking = (orderId: string) => {
  const [location, setLocation] = useState(null);
  const [status, setStatus] = useState('');

  useEffect(() => {
    const channel = supabase
      .channel(`order:${orderId}`)
      .on(
        'postgres_changes',
        {
          event: 'UPDATE',
          schema: 'public',
          table: 'food_orders',
          filter: `id=eq.${orderId}`
        },
        (payload) => {
          setLocation({
            latitude: payload.new.driver_latitude,
            longitude: payload.new.driver_longitude
          });
          setStatus(payload.new.status);
        }
      )
      .subscribe();

    return () => {
      supabase.removeChannel(channel);
    };
  }, [orderId]);

  return { location, status };
};
```

---

## ì •ê¸° ë°°ì†¡ ìë™ ì£¼ë¬¸

```typescript
// Cron Job: ë§¤ì¼ ì‹¤í–‰
export const processSubscriptionDeliveries = async () => {
  const today = new Date().toISOString().split('T')[0];
  const dayOfWeek = new Date().toLocaleDateString('en-US', { weekday: 'short' }).toLowerCase();

  // ì˜¤ëŠ˜ ë°°ì†¡ì´ ì˜ˆì •ëœ êµ¬ë… ì¡°íšŒ
  const { data: subscriptions } = await supabase
    .from('food_subscriptions')
    .select('*')
    .eq('status', 'active')
    .eq('next_delivery_date', today)
    .contains('delivery_days', [dayOfWeek]);

  for (const subscription of subscriptions) {
    // ìë™ ì£¼ë¬¸ ìƒì„±
    const order = await createOrderFromSubscription(subscription);

    // êµ¬ë… ë°°ë‹¬ ê¸°ë¡
    await supabase.from('subscription_deliveries').insert({
      subscription_id: subscription.id,
      order_id: order.id,
      delivery_date: today,
      status: 'scheduled'
    });

    // ë‹¤ìŒ ë°°ë‹¬ì¼ ê³„ì‚°
    const nextDate = calculateNextDeliveryDate(subscription);
    await supabase
      .from('food_subscriptions')
      .update({ next_delivery_date: nextDate })
      .eq('id', subscription.id);

    // ì•Œë¦¼
    await sendNotification({
      userId: subscription.user_id,
      title: 'ğŸšš ì˜¤ëŠ˜ ì •ê¸° ë°°ì†¡ ì˜ˆì •',
      body: 'ì˜¤ëŠ˜ ë„ì‹œë½ì´ ë°°ë‹¬ë©ë‹ˆë‹¤'
    });
  }
};
```

---

**ì‘ì„±ì¼**: 2025-01-24
**ë²„ì „**: 1.0
**ë‹¤ìŒ ë¬¸ì„œ**: 04-ì²­ì†Œ-ìˆ˜ë¦¬-ì‹¤ì‹œê°„-ì˜ˆì•½.md
